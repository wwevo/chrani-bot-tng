// Function to show location details in sidebar
function showLocationInSidebar(locationId, loc) {
    const coords = loc.coordinates;
    const dims = loc.dimensions || {};
    const shape = loc.shape || 'circle';
    const isEnabled = loc.is_enabled;
    const is3D = (shape === 'box' || shape === 'spherical');

    // Parse locationId to extract components
    const locationIdParts = locationId.split('_');
    const dataset = locationIdParts.slice(0, -2).join('_');
    const owner = locationIdParts[locationIdParts.length - 2];
    const identifier = locationIdParts[locationIdParts.length - 1];

    const teleportEntry = loc.teleport_entry || {};
    const hasTeleport = teleportEntry.x !== undefined && teleportEntry.y !== undefined && teleportEntry.z !== undefined;
    const teleportText = hasTeleport
        ? `${parseFloat(teleportEntry.x || 0).toFixed(0)}, ${parseFloat(teleportEntry.y || 0).toFixed(0)}, ${parseFloat(teleportEntry.z || 0).toFixed(0)}`
        : 'Not set';

    const dimensionText = shape === 'circle' || shape === 'spherical'
        ? `Radius: ${dims.radius || 'N/A'}`
        : `W: ${dims.width || 'N/A'}, L: ${dims.length || 'N/A'}${shape === 'box' ? ', H: ' + (dims.height || 'N/A') : ''}`;

    const sidebar = document.getElementById('details-panel');
    sidebar.innerHTML = `
        <h3>üìç ${loc.name}</h3>
        <div style="margin-top: 8px; padding: 8px; background: rgba(0,0,0,0.3); border-radius: 4px; border-left: 3px solid ${isEnabled ? 'var(--lcars-golden-tanoi)' : '#666'};">
            <b>${is3D ? 'üé≤ 3D' : '‚¨ú 2D'}</b> - ${shape}
            <br><b style="color: ${isEnabled ? '#66ff66' : '#ff6666'};">${isEnabled ? '‚úÖ Enabled' : '‚ùå Disabled'}</b>
        </div>
        <div style="margin-top: 12px; line-height: 1.8;">
            <b style="color: var(--lcars-hopbush);">Type:</b><br>
            <span style="color: var(--lcars-golden-tanoi);">${loc.type && loc.type.length > 0 ? loc.type.join(', ') : 'None'}</span>
            <br><br>
            <b style="color: var(--lcars-hopbush);">Owner:</b> ${loc.owner}
            <br><b style="color: var(--lcars-hopbush);">Position:</b> ${coords.x.toFixed(0)}, ${coords.y.toFixed(0)}, ${coords.z.toFixed(0)}
            <br><b style="color: var(--lcars-hopbush);">Dimensions:</b> ${dimensionText}
            <br><b style="color: var(--lcars-hopbush);">Teleport:</b> ${teleportText}
        </div>
        <div style="margin-top: 16px; padding-top: 12px; border-top: 1px solid var(--lcars-golden-tanoi);">
            <div style="display: flex; gap: 8px; align-items: center; margin-bottom: 8px;">
                <button onclick="editLocationFromMap('${dataset}', '${owner}', '${identifier}')"
                    style="flex: 1; padding: 8px; background: var(--lcars-hopbush); color: white; border: none; border-radius: 4px; cursor: pointer; font-weight: bold;">
                    ‚úèÔ∏è Edit</button>
                <label style="display: flex; align-items: center; gap: 5px; cursor: pointer; white-space: nowrap;">
                    <input type="checkbox"
                        id="enable_${locationId}"
                        ${isEnabled ? 'checked' : ''}
                        onchange="toggleLocationEnabled('${dataset}', '${owner}', '${identifier}', this.checked)"
                        style="cursor: pointer; width: 18px; height: 18px;" />
                    <span style="font-weight: bold;">Enabled</span>
                </label>
            </div>
            <button onclick="moveLocationFromMap('${locationId}')"
                style="width: 100%; padding: 8px; margin-bottom: 6px; background: var(--lcars-anakiwa); color: #000; border: none; border-radius: 4px; cursor: pointer; font-weight: bold;">
                üìç Move Location</button>
            <button onclick="setTeleportFromMap('${locationId}')"
                style="width: 100%; padding: 8px; background: var(--lcars-golden-tanoi); color: #000; border: none; border-radius: 4px; cursor: pointer; font-weight: bold;">
                üéØ Set Teleport Point</button>
        </div>
    `;
}
